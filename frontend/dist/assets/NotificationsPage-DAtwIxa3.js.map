{"version":3,"file":"NotificationsPage-DAtwIxa3.js","sources":["../../src/pages/NotificationsPage.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport config from '../config';\n\ntype Notice = {\n  id: number | string;\n  type: string;\n  title?: string;\n  message?: string;\n  created_at?: string;\n  read_at?: string | null;\n};\n\nconst NotificationsPage: React.FC = () => {\n  const [items, setItems] = useState<Notice[] | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    let alive = true;\n\n    async function load() {\n      setLoading(true);\n      setError(null);\n\n      try {\n        const token = localStorage.getItem('token') || '';\n        const res = await fetch(`${config.apiBase}/notifications`, {\n          headers: {\n            'Accept': 'application/json',\n            ...(token ? { 'Authorization': `Bearer ${token}` } : {}),\n          },\n          credentials: 'include',\n        });\n\n        // Бек может вернуть 404, если роут ещё не включён\n        if (!res.ok) {\n          const text = await res.text().catch(() => '');\n          throw new Error(`HTTP ${res.status}: ${text || res.statusText}`);\n        }\n\n        const data = await res.json();\n        // Ожидаем массив; если пришёл объект — аккуратно достанем поле\n        const list: Notice[] = Array.isArray(data)\n          ? data\n          : Array.isArray((data as any).data)\n          ? (data as any).data\n          : [];\n\n        if (!alive) return;\n        setItems(list);\n      } catch (e: any) {\n        if (!alive) return;\n        // Частый кейс — CORS/сеть\n        setError(\n          e?.message?.includes('Failed to fetch')\n            ? 'Не удалось загрузить. Проверьте сеть или CORS.'\n            : e?.message || 'Ошибка загрузки уведомлений'\n        );\n      } finally {\n        if (alive) setLoading(false);\n      }\n    }\n\n    load();\n    return () => {\n      alive = false;\n    };\n  }, []);\n\n  if (loading) {\n    return <div className=\"container\">Загрузка уведомлений…</div>;\n  }\n\n  if (error) {\n    return (\n      <div className=\"container\">\n        <div className=\"card error\">\n          <div className=\"card-title\">Ошибка</div>\n          <div className=\"card-text\">{error}</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!items || items.length === 0) {\n    return <div className=\"container\">Пока уведомлений нет.</div>;\n  }\n\n  return (\n    <div className=\"container\">\n      <h1 className=\"page-title\">Уведомления</h1>\n      <ul className=\"list\">\n        {items.map((n) => (\n          <li key={n.id} className=\"list-item\">\n            <div className=\"list-title\">{n.title || n.type}</div>\n            {n.message && <div className=\"list-subtitle\">{n.message}</div>}\n            <div className=\"list-meta\">\n              {n.created_at ? new Date(n.created_at).toLocaleString() : ''}\n              {n.read_at ? ' • прочитано' : ''}\n            </div>\n          </li>\n        ))}\n      </ul>\n    </div>\n  );\n};\n\nexport default NotificationsPage;\n"],"names":["NotificationsPage","items","setItems","useState","error","setError","loading","setLoading","useEffect","alive","load","token","res","config","text","data","list","e","jsx","jsxs","n"],"mappings":"iDAYA,MAAMA,EAA8B,IAAM,CACxC,KAAM,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAA0B,IAAI,EAClD,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAwB,IAAI,EAChD,CAACG,EAASC,CAAU,EAAIJ,EAAAA,SAAS,EAAI,EAsD3C,OApDAK,EAAAA,UAAU,IAAM,CACd,IAAIC,EAAQ,GAEZ,eAAeC,GAAO,CACpBH,EAAW,EAAI,EACfF,EAAS,IAAI,EAEb,GAAI,CACF,MAAMM,EAAQ,aAAa,QAAQ,OAAO,GAAK,GACzCC,EAAM,MAAM,MAAM,GAAGC,EAAO,OAAO,iBAAkB,CACzD,QAAS,CACP,OAAU,mBACV,GAAIF,EAAQ,CAAE,cAAiB,UAAUA,CAAK,IAAO,CAAA,CAAC,EAExD,YAAa,SAAA,CACd,EAGD,GAAI,CAACC,EAAI,GAAI,CACX,MAAME,EAAO,MAAMF,EAAI,OAAO,MAAM,IAAM,EAAE,EAC5C,MAAM,IAAI,MAAM,QAAQA,EAAI,MAAM,KAAKE,GAAQF,EAAI,UAAU,EAAE,CACjE,CAEA,MAAMG,EAAO,MAAMH,EAAI,KAAA,EAEjBI,EAAiB,MAAM,QAAQD,CAAI,EACrCA,EACA,MAAM,QAASA,EAAa,IAAI,EAC/BA,EAAa,KACd,CAAA,EAEJ,GAAI,CAACN,EAAO,OACZP,EAASc,CAAI,CACf,OAASC,EAAQ,CACf,GAAI,CAACR,EAAO,OAEZJ,EACEY,GAAG,SAAS,SAAS,iBAAiB,EAClC,iDACAA,GAAG,SAAW,6BAAA,CAEtB,QAAA,CACMR,KAAkB,EAAK,CAC7B,CACF,CAEA,OAAAC,EAAA,EACO,IAAM,CACXD,EAAQ,EACV,CACF,EAAG,CAAA,CAAE,EAEDH,EACKY,EAAAA,IAAC,MAAA,CAAI,UAAU,YAAY,SAAA,wBAAqB,EAGrDd,QAEC,MAAA,CAAI,UAAU,YACb,SAAAe,EAAAA,KAAC,MAAA,CAAI,UAAU,aACb,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,aAAa,SAAA,SAAM,EAClCA,EAAAA,IAAC,MAAA,CAAI,UAAU,YAAa,SAAAd,CAAA,CAAM,CAAA,CAAA,CACpC,CAAA,CACF,EAIA,CAACH,GAASA,EAAM,SAAW,EACtBiB,EAAAA,IAAC,MAAA,CAAI,UAAU,YAAY,SAAA,wBAAqB,EAIvDC,EAAAA,KAAC,MAAA,CAAI,UAAU,YACb,SAAA,CAAAD,EAAAA,IAAC,KAAA,CAAG,UAAU,aAAa,SAAA,cAAW,EACtCA,EAAAA,IAAC,KAAA,CAAG,UAAU,OACX,SAAAjB,EAAM,IAAKmB,GACVD,EAAAA,KAAC,KAAA,CAAc,UAAU,YACvB,SAAA,CAAAD,MAAC,OAAI,UAAU,aAAc,SAAAE,EAAE,OAASA,EAAE,KAAK,EAC9CA,EAAE,SAAWF,EAAAA,IAAC,OAAI,UAAU,gBAAiB,WAAE,QAAQ,EACxDC,EAAAA,KAAC,MAAA,CAAI,UAAU,YACZ,SAAA,CAAAC,EAAE,WAAa,IAAI,KAAKA,EAAE,UAAU,EAAE,iBAAmB,GACzDA,EAAE,QAAU,eAAiB,EAAA,CAAA,CAChC,CAAA,GANOA,EAAE,EAOX,CACD,CAAA,CACH,CAAA,EACF,CAEJ"}