const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/leaflet-src-B23CWb7s.js","assets/index-BY83b2EI.js","assets/index-D3u49sJi.css"])))=>i.map(i=>d[i]);
import{j as t,u as _,r as i,c as g,_ as $}from"./index-BY83b2EI.js";import{p as L,i as k,s as C}from"./api-DxtNjl_b.js";import{p as E}from"./Toast-Dyz104fB.js";const R=({open:s,title:r="Подтверждение",text:x="Вы уверены?",confirmText:m="ОК",cancelText:v="Отмена",onConfirm:p,onCancel:f})=>s?t.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,.35)",display:"grid",placeItems:"center",zIndex:1e4},children:t.jsxs("div",{className:"glass card",style:{minWidth:320,maxWidth:520},children:[t.jsx("div",{className:"h3",style:{marginBottom:8},children:r}),t.jsx("div",{className:"muted",style:{marginBottom:12},children:x}),t.jsxs("div",{className:"row",style:{justifyContent:"flex-end",gap:8},children:[t.jsx("button",{className:"btn",onClick:f,children:v}),t.jsx("button",{className:"btn primary",onClick:p,children:m})]})]})}):null;async function S(){return await $(()=>import("./leaflet-src-B23CWb7s.js").then(r=>r.l),__vite__mapDeps([0,1,2]))}const P=()=>{const s=_(),r=i.useRef(null),[x,m]=i.useState([]),[v,p]=i.useState(null),[f,h]=i.useState(!1),c=i.useRef(null);i.useEffect(()=>{(async()=>{const a=await S();p(a);const l=await L(void 0).catch(()=>[]);m(Array.isArray(l)?l:[]);const d=a.map("map",{center:[55.75,37.6],zoom:10});a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(d),r.current=d,(Array.isArray(l)?l:[]).forEach(e=>{const n=a.marker([e.lat,e.lng]).addTo(d),o=`
          <div style="min-width:180px">
            <div style="font-weight:600;margin-bottom:6px">${e.title||"Точка"}</div>
            ${e.preview?`<img src="${e.preview}" alt="" style="width:100%;height:100px;object-fit:cover;border-radius:8px" />`:""}
            <div style="margin-top:6px;display:flex;gap:8;justify-content:flex-end">
              <a href="/place/${e.id}" data-id="${e.id}" data-type="${e.type||"place"}">Открыть</a>
            </div>
          </div>`;n.bindPopup(o),n.on("popupopen",w=>{setTimeout(()=>{const u=w.popup?._contentNode?.querySelector("a[data-id]");u&&u.addEventListener("click",A=>{A.preventDefault();const y=u.getAttribute("data-id"),N=u.getAttribute("data-type");s(N==="catch"?`/catch/${y}`:`/place/${y}`)},{once:!0})},0)})}),d.on("click",e=>{const{lat:n,lng:o}=e.latlng||{};!n||!o||(c.current={lat:n,lng:o,title:`Точка ${n.toFixed(4)}, ${o.toFixed(4)}`},h(!0))})})()},[s]);function j(){h(!1),c.current=null}function b(){h(!1);const a=c.current;if(c.current=null,!!a){if(g.auth.requireAuthForWeatherSave&&!k()){confirm(`Сохранять точки могут только авторизованные.
Перейти к авторизации?`)&&(window.location.href="/login");return}C(a),E("Точка сохранена для страницы погоды")}}return t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"glass card",style:{marginBottom:8},children:["Нажмите по карте, чтобы предложить сохранить точку в “Погоду”. ",g.auth.requireAuthForWeatherSave?"(Требуется вход)":""]}),t.jsx("div",{id:"map",style:{height:"70vh",width:"100%",borderRadius:16,overflow:"hidden"}}),t.jsx(R,{open:f,title:"Сохранить точку?",text:"Добавить выбранную точку на страницу погоды?",confirmText:"Сохранить",cancelText:"Отмена",onConfirm:b,onCancel:j})]})};export{P as default};
//# sourceMappingURL=MapScreen-CP8S4w6Z.js.map
