import{u as g,r as c,c as h,j as s,I as y}from"./index-Cex0JMuM.js";import{p as x,i as b,s as v}from"./api-DpD81C9e.js";function w(){const[i,n]=c.useState(!!window.L);return c.useEffect(()=>{if(window.L){n(!0);return}const a="leaflet-css-cdn";if(!document.getElementById(a)){const e=document.createElement("link");e.id=a,e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",e.integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=",e.crossOrigin="",document.head.appendChild(e)}const o="leaflet-js-cdn";if(document.getElementById(o))n(!0);else{const e=document.createElement("script");e.id=o,e.src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js",e.integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=",e.crossOrigin="",e.onload=()=>n(!0),document.body.appendChild(e)}},[]),i}function R(){const i=g(),n=c.useRef(null),a=w();return c.useEffect(()=>{if(!a||!n.current)return;const o=window.L;if(!o)return;const e=o.map(n.current).setView([55.751244,37.618423],9),m=h?.map?.tiles??"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";return o.tileLayer(m,{maxZoom:19}).addTo(e),(async()=>{try{const r=await x({limit:500});(Array.isArray(r)?r:Array.isArray(r?.items)?r.items:[]).forEach(t=>{if(typeof t?.lat!="number"||typeof t?.lng!="number")return;const p=o.marker([t.lat,t.lng]).addTo(e),u=`
            <div style="display:flex;gap:8px;align-items:center">
              ${t.thumbnail?`<img src="${t.thumbnail}" style="width:56px;height:56px;object-fit:cover;border-radius:8px" />`:""}
              <div>
                <div style="font-weight:600">${t.title??"Точка"}</div>
                <button data-id="${t.id}" class="go-detail" style="margin-top:6px;padding:6px 10px;border-radius:8px;background:#0ea5e9;color:#fff;border:0;cursor:pointer">Открыть</button>
              </div>
            </div>
          `;p.bindPopup(u),p.on("popupopen",l=>{const f=l.popup.getElement().querySelector(".go-detail");f&&(f.onclick=()=>{t.type==="catch"?i(`/catch/${t.id}`):i(`/place/${t.id}`)})})})}catch(r){console.error("points load error",r)}})(),e.on("click",async r=>{const{lat:d,lng:t}=r.latlng||{};if(typeof d!="number"||typeof t!="number")return;if(!await b()){confirm("Сохранение точки доступно только авторизованным пользователям. Войти сейчас?")&&i("/login");return}if(!confirm("Сохранить эту точку для страницы погоды?"))return;const u=prompt("Название точки","Моя точка");try{await v({lat:d,lng:t,name:u||"Моя точка"}),alert("Точка сохранена. Проверьте на странице Погоды.")}catch(l){console.error("saveWeatherFav error",l),alert("Не удалось сохранить точку")}}),()=>e.remove()},[a]),s.jsxs("div",{style:{position:"relative",width:"100%",height:"calc(100dvh - 116px)"},children:[s.jsx("div",{ref:n,style:{width:"100%",height:"100%"}}),s.jsxs("div",{style:{position:"absolute",top:12,right:12,backdropFilter:"blur(10px)",background:"rgba(255,255,255,0.3)",border:"1px solid rgba(255,255,255,0.4)",borderRadius:16,padding:"8px 10px",display:"flex",gap:8},children:[s.jsx(y,{name:"my_location"}),s.jsx("span",{style:{fontWeight:600},children:"Карта"})]})]})}export{R as default};
//# sourceMappingURL=MapScreen-BLwvkYYZ.js.map
